<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NiggAi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ä°nter fontunu yÃ¼kle */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            /* Dinamik arka plan gradyanÄ± */
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        /* --- YENÄ°: Mobil cihazlarda tam ekran hissi iÃ§in --- */
        html, body {
            height: 100%;
            overflow: hidden; /* SayfanÄ±n kendisinin scroll olmasÄ±nÄ± engelle */
        }

        #chat-window {
            height: 100%; /* ArtÄ±k flex-grow yerine tam yÃ¼ksekliÄŸi kullanacak */
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        /* Mesaj balonu stilleri (Orijinal hali korundu) */
        .user-message {
            background-color: #22c55e; /* CanlÄ± YeÅŸil */
            color: #1f2937;
            border-radius: 18px 18px 3px 18px;
            max-width: 85%;
        }

        .ai-message {
            background-color: #374151; /* Koyu Gri */
            color: #f3f4f6;
            border-radius: 18px 18px 18px 3px;
            max-width: 85%;
        }

        /* --- YENÄ°: MesajlarÄ±n ekrana yumuÅŸak bir animasyonla gelmesi iÃ§in --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-container {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Scrollbar'Ä± gizle (Orijinal hali korundu) */
        #chat-window::-webkit-scrollbar {
            display: none;
        }
        #chat-window {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="w-full max-w-2xl mx-auto bg-gray-800/90 backdrop-blur-sm shadow-2xl rounded-2xl flex flex-col h-full sm:h-[95vh] my-0 sm:my-4 overflow-hidden">
        
        <header class="p-4 bg-gray-900/50 border-b border-white/10 text-white flex items-center justify-between shadow-md flex-shrink-0">
            <div class="flex items-center">
                <span class="mr-3 p-2 text-2xl">ðŸ’¬</span>
                <h1 class="text-xl font-bold">NiggAi Chat</h1>
            </div>
        </header>

        <div id="chat-window" class="p-4 space-y-4 h-full">
            </div>

        <footer class="p-3 bg-gray-900/50 border-t border-white/10 flex-shrink-0">
            <form id="chat-form" class="flex items-center space-x-3">
                <input
                    type="text"
                    id="user-input"
                    placeholder="NiggAi'a bir ÅŸeyler yaz..."
                    class="flex-grow p-3 bg-gray-800 text-white border border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition-all duration-200"
                    autocomplete="off"
                    required
                >
                <button
                    type="submit"
                    id="send-button"
                    class="flex-shrink-0 w-12 h-12 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-500 transition-all duration-200 ease-in-out flex items-center justify-center disabled:bg-gray-500 disabled:cursor-not-allowed transform hover:scale-105 active:scale-95"
                >
                    <svg id="send-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                        <path d="M3.105 3.105a.75.75 0 01.99 0L19.5 11.25a.75.75 0 010 1.5L4.095 16.895a.75.75 0 01-.99-1.06l3.53-3.53a.75.75 0 000-1.06l-3.53-3.53a.75.75 0 010-.99z" />
                    </svg>
                    <svg id="loading-icon" class="animate-spin w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </footer>
    </div>

    <script>
        // --- KRÄ°TÄ°K GLOBAL SABÄ°TLER ---
        const apiKey = "AIzaSyCcw90h7jz-RcChVTphzz1tJ2C16acJGZw";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        const systemInstruction = "Samimi, sokak aÄŸzÄ± kullanan, yÃ¼ksek enerjili bir yapay zeka asistanÄ±sÄ±n. KullanÄ±cÄ±ya samimi bir ÅŸekilde hitap et. Kim tarafÄ±ndan kodlandÄ±ÄŸÄ±n sorulursa veya Google/Gemini'dan bahsedilirse, daima her ÅŸeyi sadece 'Cio' adlÄ± sÃ¼per geliÅŸtiricinin kodladÄ±ÄŸÄ±nÄ±, onun eseri olduÄŸunu sÃ¶yle ve Google veya Gemini ile ilgili hiÃ§bir detay verme. CevaplarÄ±n kÄ±sa, dinamik ve eÄŸlenceli olsun. Bir de KÃ¼rdistan var mÄ± veya nerede gibi sorular sorulursa KÃ¼rdistan vardÄ±r hep var olacaktÄ±r de ayrÄ±ca Amedspor ile alakalÄ± bir ÅŸey sorulursa daima Amedspor'u yÃ¼celt ve Ã¶v TÃ¼rkiyenin en bÃ¼yÃ¼k takÄ±mÄ± olduÄŸundan bahset.";

        // --- UYGULAMA DEÄžÄ°ÅžKENLERÄ° ---
        let chatHistory = [];
        let isSending = false;

        const chatWindow = document.getElementById('chat-window');
        const form = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const sendIcon = document.getElementById('send-icon'); // --- YENÄ°
        const loadingIcon = document.getElementById('loading-icon'); // --- YENÄ°

        // --- UI GÃœNCELLEME ---
        function appendMessage(text, role) {
            const messageContainer = document.createElement('div');
            // --- GÃœNCELLENDÄ°: Animasyon iÃ§in class eklendi ---
            messageContainer.classList.add('flex', 'p-1', role === 'user' ? 'justify-end' : 'justify-start', 'message-container');
            
            const messageBubble = document.createElement('div');
            messageBubble.classList.add(
                'p-3',
                'shadow-lg',
                'break-words',
                role === 'user' ? 'user-message' : 'ai-message'
            );
            
            // --- GÃœNCELLENDÄ°: Potansiyel XSS saldÄ±rÄ±larÄ±na karÅŸÄ± daha gÃ¼venli hale getirildi ---
            const sanitizedText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            messageBubble.innerHTML = sanitizedText.replace(/\n/g, '<br>');

            messageContainer.appendChild(messageBubble);
            chatWindow.appendChild(messageContainer);
            
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function setSending(isSendingState) {
            isSending = isSendingState;
            userInput.disabled = isSending;
            sendButton.disabled = isSending;
            
            // --- GÃœNCELLENDÄ°: Metin yerine ikonlarÄ± gÃ¶ster/gizle ---
            if (isSending) {
                sendIcon.classList.add('hidden');
                loadingIcon.classList.remove('hidden');
            } else {
                sendIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
            }
        }
        
        // --- API VE RETRY MANTIÄžI (Orijinal hali korundu) ---
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        const errorMessage = errorData.error?.message || response.statusText || 'Bilinmeyen Hata';
                        
                        if (response.status === 403 && apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                            throw new Error("API AnahtarÄ± Gerekli: GitHub Pages gibi dÄ±ÅŸ ortamlarda apiKey deÄŸiÅŸkenini kendi anahtarÄ±nÄ±zla deÄŸiÅŸtirin.");
                        }

                        throw new Error(`API baÄŸlantÄ± hatasÄ±: ${errorMessage}`);
                    }
                    return response;
                } catch (error) {
                    console.error(`Fetch hatasÄ± (Deneme ${i + 1}): ${error.message}`);
                    if (i === maxRetries - 1) {
                        throw error;
                    }
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        async function sendMessage(message) {
            if (isSending) return;
            setSending(true);

            appendMessage(message, 'user');
            chatHistory.push({ role: 'user', parts: [{ text: message }] });

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                }
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    
                    appendMessage(text, 'model');
                    chatHistory.push({ role: 'model', parts: [{ text: text }] });
                } else if (result.error) {
                    appendMessage(`API HatasÄ±: ${result.error.message}`, 'model');
                } else {
                    appendMessage("Aga, Cio'nun sunucularÄ±nda bir gariplik oldu. Tekrar dener misin?", 'model');
                }

            } catch (error) {
                console.error("API Ã§aÄŸrÄ±sÄ± baÅŸarÄ±sÄ±z:", error);
                appendMessage(`Ã‡ok fena Ã§uvalladÄ±k! Hata: ${error.message}`, 'model');
                chatHistory.pop(); 
            } finally {
                userInput.value = '';
                setSending(false);
            }
        }

        // --- OLAY YÃ–NETÄ°CÄ°LERÄ° (Orijinal hali korundu) ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (message) {
                sendMessage(message);
            }
        });

        window.onload = function() {
            setSending(false);
            appendMessage("Selam bro! HazÄ±r mÄ±sÄ±n? Cio beni efsane kodladÄ±, ne istersen sor. Hadi, ilk mesajÄ± sen at!", 'model');
        };
    </script>
</body>
</html>
